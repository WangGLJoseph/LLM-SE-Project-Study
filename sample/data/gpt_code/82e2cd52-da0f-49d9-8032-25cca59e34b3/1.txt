TEST_CASE("Valid Declarations", "[DeclarationsParser]") {
	DeclarationsParser parser;
	std::vector<std::string> tokens = { "variable", "a", ",", "b", ",", "x", ";" };
	std::unordered_map<std::string, EntityType> synonymMap = {};
	auto declarations = DeclarationsParser::parse(tokens, synonymMap);

	REQUIRE(declarations.size() == 3);
	REQUIRE(synonymMap.size() == 3);

	REQUIRE(synonymMap["a"] == EntityType::Variable);
	REQUIRE(synonymMap["b"] == EntityType::Variable);
	REQUIRE(synonymMap["x"] == EntityType::Variable);

}

TEST_CASE("Single Declaration", "[DeclarationsParser]") {
	DeclarationsParser parser;
	std::vector<std::string> tokens = { "variable", "a", ";" };
	std::unordered_map<std::string, EntityType> synonymMap = {};
	auto declarations = DeclarationsParser::parse(tokens, synonymMap);

    REQUIRE(declarations[0].get()->getName() == "a");
    REQUIRE(declarations[0].get()->getType() == EntityType::Variable);
	REQUIRE(declarations.size() == 1);
	REQUIRE(synonymMap.find("a") != synonymMap.end());
}

TEST_CASE("Invalid First Token", "[DeclarationsParser]") {
	DeclarationsParser parser;
	std::vector<std::string> tokens = { "InvalidType", "a", ";" };
	std::unordered_map<std::string, EntityType> synonymMap = { {"Variable", EntityType::Variable} };

	REQUIRE_THROWS_AS(parser.parse(tokens, synonymMap), SyntaxErrorException);
}

TEST_CASE("Duplicate Names", "[DeclarationsParser]") {
	DeclarationsParser parser;
	std::vector<std::string> tokens = { "while", "a", ",", "a", ";" };
	std::unordered_map<std::string, EntityType> synonymMap = { {"Variable", EntityType::Variable} };

	REQUIRE_THROWS_AS(parser.parse(tokens, synonymMap), SemanticErrorException);
}
